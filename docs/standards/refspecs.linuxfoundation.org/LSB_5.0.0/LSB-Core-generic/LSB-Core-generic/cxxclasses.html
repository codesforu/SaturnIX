<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>C++ Class Representations</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Linux Standard Base Core Specification, Generic Part"
HREF="book1.html"><LINK
REL="UP"
TITLE="Executable And Linking Format (ELF)"
HREF="elf-generic.html"><LINK
REL="PREVIOUS"
TITLE="Dynamic Entries"
HREF="dynamicsection.html"><LINK
REL="NEXT"
TITLE="Symbol Mapping"
HREF="symmap.cxx.html"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Linux Standard Base Core Specification, Generic Part</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dynamicsection.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="symmap.cxx.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="CXXCLASSES"
></A
>Chapter 12. C++ Class Representations</H1
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CXXDATAREPRESENTATION"
>12.1. C++ Data Representation</A
></H1
><P
>Support for the C++ language shall be as specified in
<A
HREF="normativerefs.html#STD.CXXABI"
>Itanium&#8482; C++ ABI</A
>. 
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>This document, although containing a few architecture specific
matters, is written as a generic specification, to be usable by C++
implementations on a variety of architectures.</P
></BLOCKQUOTE
></DIV
>
This section provides additional information to
supplement <A
HREF="normativerefs.html#STD.CXXABI"
>Itanium&#8482; C++ ABI</A
>. Many of the definitions
in that document are
made in terms of C++. This section provides addition explanations
using C terms to avoid self-referential problems.</P
><P
></P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CLASSES"
>12.1.1. Class Representation</A
></H2
><P
>An object file generated by the compilation process for a C++ program shall
contain several closely related internal objects, or Class Components, to
represent each C++ Class. Such objects are not a visible part of the source
code. <A
HREF="cxxclasses.html#TBL-CXX-CLASSREP"
>Table 12-1</A
>
describes these Class Components at a high level.
<DIV
CLASS="TABLE"
><A
NAME="TBL-CXX-CLASSREP"
></A
><P
><B
>Table 12-1. Class Components</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
CELLSPACING="0"
CELLPADDING="4"
CLASS="CALSTABLE"
><THEAD
><TR
><TH
>Object</TH
><TH
>Contains</TH
></TR
></THEAD
><TBODY
><TR
><TD
>Class Data</TD
><TD
>All non-static Class members</TD
></TR
><TR
><TD
>Virtual Table</TD
><TD
>Information needed to dispatch virtual functions, access virtual base class subobjects and to access the RTTI information</TD
></TR
><TR
><TD
>RTTI</TD
><TD
>Run-Time Type Information used by the typeid and dynamic_cast operators, and exception handlers</TD
></TR
><TR
><TD
>Typeinfo Name</TD
><TD
>String representation of Class name</TD
></TR
><TR
><TD
>Construction Virtual Table</TD
><TD
>Information needed during construction and destruction of Classes with non-trivial inheritance relationships.</TD
></TR
><TR
><TD
>VTT</TD
><TD
>A table of virtual table pointers which holds the addresses of construction and non-construction virtual tables.</TD
></TR
></TBODY
></TABLE
></DIV
></P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="VIRTUALTABLE"
>12.1.1.1. Virtual Table</A
></H3
><P
>Virtual tables are specified in Section 2.5.3 of <A
HREF="normativerefs.html#STD.CXXABI"
>Itanium&#8482; C++ ABI</A
>.</P
><P
>Of the various categories of virtual table described in that specification,
Category 1 (Leaf) is further described in <A
HREF="cxxclasses.html#CXX-VIRTUALTABLE-CAT1"
>Figure 12-1</A
> and
Category 2 (Non-virtual bases only) is further described in
<A
HREF="cxxclasses.html#CXX-VIRTUALTABLE-CAT2"
>Figure 12-2</A
>. 
LSB conforming systems shall support these
categories.</P
><DIV
CLASS="FIGURE"
><A
NAME="CXX-VIRTUALTABLE-CAT1"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
        ptrdiff_t       baseobject;
        const char      *typeinfo;
        fptr            virtfuncs[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-1. Category 1 Virtual Table</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-VIRTUALTABLE-CAT2"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
        unsigned long   vcalloffset;
        ptrdiff_t       baseobject;
        const char      *typeinfo;
        fptr            virtfuncs[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-2. Category 2 Virtual Table</B
></P
></DIV
><P
>This specification describes requirements for virtual tables of C++ classes
using tables of the following form:</P
><DIV
CLASS="TABLE"
><A
NAME="TBL-CXX-VTABLE"
></A
><P
><B
>Table 12-2. Primary vtable for K (example)</B
></P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
CELLSPACING="0"
CELLPADDING="4"
CLASS="CALSTABLE"
><TBODY
><TR
><TD
>Base Offset</TD
><TD
>0</TD
></TR
><TR
><TD
>Virtual Base Offset</TD
><TD
>0</TD
></TR
><TR
><TD
>RTTI</TD
><TD
>typeinfo for K</TD
></TR
><TR
><TD
>vfunc[0]:</TD
><TD
>K::~K()</TD
></TR
><TR
><TD
>vfunc[1]:</TD
><TD
>K::~K()</TD
></TR
><TR
><TD
>vfunc[2]:</TD
><TD
>K::m1(int*)</TD
></TR
><TR
><TD
>vfunc[3]:</TD
><TD
>X::m2()</TD
></TR
><TR
><TD
>vfunc[4]:</TD
><TD
><TT
CLASS="FUNCTION"
>__cxa_pure_virtual()</TT
></TD
></TR
><TR
><TD
>vfunc[5]:</TD
><TD
>NULL or X::m4(int)</TD
></TR
></TBODY
></TABLE
></DIV
><P
>Each row starting from 'vfunc[i]:' refers to a vtable entry 'vfunc[i]' of a
class K, which is an entry for a virtual function A::m, where A is a base class
of the class K as described in the <A
HREF="normativerefs.html#STD.CXXABI"
>Itanium&#8482; C++ ABI</A
>.
This specification requires implementations to interpret the vtable
entry information in the following way:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>A conforming implementation shall contain a vtable of the class K
in the specified shared library;</P
></LI
><LI
><P
>The corresponding entry of this vtable 'vfunc[i]'
shall be an entry for the virtual function A::m;</P
></LI
><LI
><P
>If the second column of the row contains <TT
CLASS="FUNCTION"
>__cxa_pure_virtual()</TT
>
the corresponding vtable entry of a LSB-conforming implementation
shall contain <TT
CLASS="FUNCTION"
>__cxa_pure_virtual()</TT
> or 'Y::m',
where Y is the class K, the class A or
a base class of the class K derived from the class A.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>In this case virtual function A::m in class K is considered
to be specified as pure virtual by this specification.</P
></BLOCKQUOTE
></DIV
></P
></LI
><LI
><P
>If the second column of the row contains 'X::m'
the corresponding vtable entry of a LSB-conforming implementation
shall contain 'Y::m', where Y is the class K, the class X
or a base class of the class K derived from the class X.</P
></LI
><LI
><P
>If the second column of the row contains 'NULL or X::m'
the corresponding vtable entry of a LSB-conforming implementation
shall contain NULL or 'Y::m', where Y is the class K, the class X
or a base class of the class K derived from the class X.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>In this case virtual function A::m in class K is considered
to be specified as inline by this specification.</P
></BLOCKQUOTE
></DIV
></P
></LI
></OL
><P
>An application may use any non-pure virtual function
specified in this specification, and can expect the
specified behavior irrespective of which particular
method implements this functionality.
An application may not use inline virtual functions at the
binary level since its vtable entry may be <CODE
CLASS="CONSTANT"
>NULL</CODE
>.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="RTTI"
>12.1.1.2. Run-Time Type Information</A
></H3
><P
>Each type used in a C++ program has a data structure associated with it that
provide information about the type which is used at runtime. This Run Time
Type Information (RTTI) is defined in section 2.9.5 in
<A
HREF="normativerefs.html#STD.CXXABI"
>Itanium&#8482; C++ ABI</A
>. Additional details about the layout of this
data is provided here.</P
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
       void      *basevtable;
       char      *name;
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-3. Run-Time Type Information Prefix</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI-CLASS"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
       void      *basevtable;
       char      *name;
       void      *basetypeinfo[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-4. Run-Time Type Information For Classes with no base class</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI-SICLASS"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
       void      *basevtable;
       char      *name;
       void      *basetype;
       void      *basetypeinfo[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-5. Run-Time Type Information for Classes with a single base class</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI-VMICLASS"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct base_type_info {
       char    *base_type;
       unsigned long   offset_flags;
};

struct {
       void    *basevtable;
       char    *name;
       unsigned int    flags;
       unsigned int    base_count;
       struct base_type_info base_info[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-6. Run-Time Type Information for classes with multiple inheritance</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI-POINTERCLASS"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
       void    *basevtable;
       char    *name;
       unsigned int    flags;
       void    *pointee;
       void    *basetypeinfo[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-7. Run-Time Type Information for pointer types</B
></P
></DIV
><DIV
CLASS="FIGURE"
><A
NAME="CXX-RTTI-PTOMEMBERCLASS"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>struct {
       void    *basevtable;
       char    *name;
       unsigned int    flags;
       void    *pointee;
       void    *context;
       void    *basetypeinfo[0];
};</PRE
></TD
></TR
></TABLE
><P
><B
>Figure 12-8. Run-Time Type Information for pointer to member types</B
></P
></DIV
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dynamicsection.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="symmap.cxx.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Dynamic Entries</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="elf-generic.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Symbol Mapping</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>