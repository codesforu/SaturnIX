<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Init Script Functions</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Linux Standard Base Core Specification, Generic Part"
HREF="book1.html"><LINK
REL="UP"
TITLE="System Initialization"
HREF="sysinit.html"><LINK
REL="PREVIOUS"
TITLE="Script Names"
HREF="scrptnames.html"><LINK
REL="NEXT"
TITLE="Users &#38; Groups"
HREF="tocusersgroups.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Linux Standard Base Core Specification, Generic Part</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="scrptnames.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 22. System Initialization</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="tocusersgroups.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INISCRPTFUNC"
>22.8. Init Script Functions</A
></H1
><P
>Each conforming init script shall execute the commands in the file
<TT
CLASS="FILENAME"
>/lib/lsb/init-functions</TT
> in the 
current environment (see shell special built-in command <B
CLASS="COMMAND"
>dot</B
>).
This file shall cause the
following shell script commands to be defined in an unspecified manner.  
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>This can be done either by
adding a directory to the 
<CODE
CLASS="ENVAR"
>PATH</CODE
> variable which defines these commands, or by
defining shell aliases or functions.  </P
><P
STYLE="color: #006600; background-color: #FFFFCC;"
>Although the commands made available via this mechanism need not
be conforming applications in their own right, applications that
use them should only depend on features described in this specification.</P
></BLOCKQUOTE
></DIV
>
Conforming scripts
shall not specify the "exit on error" option (i.e. 
<B
CLASS="COMMAND"
>set -e</B
>) when sourcing this file, or calling any of the
commands thus made available. </P
><P
>The <B
CLASS="COMMAND"
>start_daemon</B
>, <B
CLASS="COMMAND"
>killproc</B
> and
<B
CLASS="COMMAND"
>pidofproc</B
> functions shall use 
the following algorithm for determining
the status and the process identifiers of the specified program. 
<P
></P
><OL
TYPE="1"
><LI
><P
>If the <TT
CLASS="PARAMETER"
><I
>-p pidfile</I
></TT
> option is specified,
and the named <TT
CLASS="FILENAME"
>pidfile</TT
> exists,
a single line at the start of the <TT
CLASS="FILENAME"
>pidfile</TT
> shall be read. 
If this line contains one or more numeric values, separated by spaces,
these values shall be used.
If the <TT
CLASS="PARAMETER"
><I
>-p pidfile</I
></TT
> option is specified and the named 
<TT
CLASS="FILENAME"
>pidfile</TT
> does not exist, the functions
shall assume that the daemon is not running.</P
></LI
><LI
><P
>Otherwise, 
<TT
CLASS="FILENAME"
>/var/run/<TT
CLASS="REPLACEABLE"
><I
>basename</I
></TT
>.pid</TT
> 
shall be read in a similar fashion.
If this contains one or more numeric values on the first line, these values
shall be used.
Optionally, implementations may use unspecified additional
methods to locate the process identifiers required.</P
></LI
></OL
>
The method used
to determine the status is implementation defined, but should allow for
non-binary programs.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>Commonly used methods check either for the
existence of the <TT
CLASS="FILENAME"
>/proc/pid</TT
> directory or use
<TT
CLASS="FILENAME"
>/proc/pid/exe</TT
> and <TT
CLASS="FILENAME"
>/proc/pid/cmdline</TT
>.
Relying only on <TT
CLASS="FILENAME"
>/proc/pid/exe</TT
> is discouraged since this
specification does not specify the existence of, or semantics
for, <TT
CLASS="FILENAME"
>/proc</TT
>. Additionally, using
<TT
CLASS="FILENAME"
>/proc/pid/exe</TT
>
may result in a not-running status for daemons that are written in a script
language.</P
></BLOCKQUOTE
></DIV
>
Conforming implementations may use other mechanisms besides those based on
pidfiles, unless the <TT
CLASS="PARAMETER"
><I
>-p pidfile</I
></TT
>
option has been used. Conforming applications
should not rely on such mechanisms and should
always use a <TT
CLASS="FILENAME"
>pidfile</TT
>.
When a program is stopped, it should delete its
<TT
CLASS="FILENAME"
>pidfile</TT
>. Multiple process identifiers
shall be separated by a single space in the <TT
CLASS="FILENAME"
>pidfile</TT
>
and in the output of <B
CLASS="COMMAND"
>pidofproc</B
>.</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>start_daemon</B
> [-f] [-n nicelevel] [-p pidfile]  pathname  [args...]</TT
></DT
><DD
><P
>runs the specified program as a daemon.
The <B
CLASS="COMMAND"
>start_daemon</B
> function
shall check if the program is already running
using the algorithm given above. If so, it shall not
start another copy of the daemon unless the <TT
CLASS="PARAMETER"
><I
>-f</I
></TT
>
option is given. The <TT
CLASS="PARAMETER"
><I
>-n</I
></TT
> option specifies a nice
level. See <B
CLASS="COMMAND"
>nice</B
>.
<B
CLASS="COMMAND"
>start_daemon</B
> shall
return the LSB defined exit status codes. It
shall return 0 if the program has been successfully started or
is running and not 0 otherwise.</P
></DD
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>killproc</B
> [-p pidfile]  pathname  [signal]</TT
></DT
><DD
><P
>The <B
CLASS="COMMAND"
>killproc</B
> function
shall stop the specified program. The program is 
found using the algorithm given above. If a
signal is specified, using the
<TT
CLASS="PARAMETER"
><I
>-<TT
CLASS="REPLACEABLE"
><I
>signal_name</I
></TT
></I
></TT
> or
<TT
CLASS="PARAMETER"
><I
>-<TT
CLASS="REPLACEABLE"
><I
>signal_number</I
></TT
></I
></TT
> syntaxes
as specified by the <B
CLASS="COMMAND"
>kill</B
> command,
the program is sent that signal.
Otherwise, a <CODE
CLASS="CONSTANT"
>SIGTERM</CODE
> followed by a 
<CODE
CLASS="CONSTANT"
>SIGKILL</CODE
>
after an unspecified number of seconds shall be sent.
If a program has been terminated, the <TT
CLASS="FILENAME"
>pidfile</TT
>
should be removed if the
terminated process has not already done so.
The <B
CLASS="COMMAND"
>killproc</B
> function
shall return the LSB defined exit status codes. If called
without a signal, it shall return 0 if the program has been stopped or
is not running and not 0 otherwise. If a signal is given, it shall return 0
only if the program is running. </P
></DD
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>pidofproc</B
> [-p pidfile]  pathname </TT
></DT
><DD
><P
>The <B
CLASS="COMMAND"
>pidofproc</B
> function shall return
one or more process identifiers for a particular
daemon using the algorithm given above. Only process identifiers
of running processes should be returned.
Multiple process identifiers shall be separated by a single space.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>A process may exit between <B
CLASS="COMMAND"
>pidofproc</B
> discovering its identity
and the caller of <B
CLASS="COMMAND"
>pidofproc</B
> being able to act on that identity.
As a result, no test assertion can be made that the process identifiers
returned by <B
CLASS="COMMAND"
>pidofproc</B
> <I
CLASS="EMPHASIS"
>shall</I
> be
running processes.</P
></BLOCKQUOTE
></DIV
>
The <B
CLASS="COMMAND"
>pidofproc</B
> function
shall return the LSB defined exit status
codes for "status". It shall return 0 if the program is
running and not 0 otherwise.</P
></DD
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>log_success_msg</B
>  message </TT
></DT
><DD
><P
>The <B
CLASS="COMMAND"
>log_success_msg</B
> function
shall cause the system to write a success
message to an unspecified log file. The format of the message is
unspecified.
The <B
CLASS="COMMAND"
>log_success_msg</B
> function
may also write a message to the standard output.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>The message should be relatively short; no
more than 60 characters is highly desirable.</P
></BLOCKQUOTE
></DIV
></P
></DD
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>log_failure_msg</B
>  message </TT
></DT
><DD
><P
>The <B
CLASS="COMMAND"
>log_failure_msg</B
> function
shall cause the system to write a failure
message to an unspecified log file. The format of the message is
unspecified.
The <B
CLASS="COMMAND"
>log_failure_msg</B
> function
may also write a message to the standard output.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>The message should be relatively short; no
more than 60 characters is highly desirable.</P
></BLOCKQUOTE
></DIV
></P
></DD
><DT
><TT
CLASS="CMDSYNOPSIS"
><B
CLASS="COMMAND"
>log_warning_msg</B
>  message </TT
></DT
><DD
><P
>The <B
CLASS="COMMAND"
>log_warning_msg</B
> function
shall cause the system to write a warning
message to an unspecified log file. The format of the message is
unspecified.
The <B
CLASS="COMMAND"
>log_warning_msg</B
> function
may also write a message to the standard output.
<DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
STYLE="color: #006600; background-color: #FFFFCC;"
><B
>Note: </B
>The message should be relatively short; no
more than 60 characters is highly desirable.</P
></BLOCKQUOTE
></DIV
></P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="scrptnames.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="tocusersgroups.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Script Names</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sysinit.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Users &#38; Groups</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>